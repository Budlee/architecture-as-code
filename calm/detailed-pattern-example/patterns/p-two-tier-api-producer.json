{
    "$schema": "https://calm.finos.org/draft/2024-12/meta/calm.json",
    "$id": "https://raw.githubusercontent.com/finos/architecture-as-code/main/calm/pattern/api-gateway",
    "title": "Two tier API Producer Pattern",
    "type": "object",
    "properties": {
      "nodes": {
        "type": "array",
        "minItems": 2,
        "maxItems": 2,
        "prefixItems": [
          {
            "$ref": "https://calm.finos.org/draft/2024-12/meta/core.json#/defs/node",
            "properties": {
              "description": {
                "const": "The API Producer serving content"
              },
              "node-type": {
                "const": "service"
              },
              "name": {
                "const": "API Producer"
              },
              "unique-id": {
                "const": "api-producer"
              },
              "interfaces": {
                "type": "array",
                "minItems": 1,
                "prefixItems": [
                  {
                    "$ref": "https://calm.finos.org/draft/2024-12/meta/interface.json#/defs/host-port-interface",
                    "properties": {
                      "unique-id": {
                        "const": "producer-ingress"
                      }
                    }
                  }
                ]
              }
            },
            "required": [
              "interfaces"
            ]
          },
          {
            "$ref": "https://calm.finos.org/draft/2024-12/meta/core.json#/defs/node",
            "properties": {
              "description": {
                "const": "The database for storing content content"
              },
              "node-type": {
                "const": "database"
              },
              "name": {
                "const": "Database"
              },
              "unique-id": {
                "const": "database-for-api-producer"
              },
              "interfaces": {
                "type": "array",
                "minItems": 1,
                "prefixItems": [
                  {
                    "$ref": "https://calm.finos.org/draft/2024-12/meta/interface.json#/defs/host-port-interface",
                    "properties": {
                      "unique-id": {
                        "const": "db-connection"
                      }
                    }
                  }
                ]
              }
            },
            "required": [
              "interfaces"
            ]
          }
        ]
      },
      "relationships": {
        "type": "array",
        "minItems": 1,
        "maxItems": 1,
        "prefixItems": [
          {
            "$ref": "https://calm.finos.org/draft/2024-12/meta/core.json#/defs/relationship",
            "properties": {
              "unique-id": {
                "const": "api-producer-database"
              },
              "description": {
                  "const": "Database request"
              },
              "relationship-type": {
                "const": {
                  "connects": {
                    "source": {
                      "node": "api-producer"
                    },
                    "destination": {
                      "node": "database-for-api-producer",
                      "interfaces": [
                        "db-connection"
                      ]
                    }
                  }
                }
              },
              "protocol": {
                "const": "JDBC"
              }
            }
          }
        ]
      }
    },
    "required": [
      "nodes",
      "relationships"
    ]
  }